{"id":"f6a638b6-3a52-4a20-b69a-68bb8ce20b57","name":"csv-export","description":"","settings":{"global":{"executionMode":"local","userPluginsJars":[],"preExecutionSqlSentences":[],"postExecutionSqlSentences":[],"addAllUploadedPlugins":true,"mesosConstraint":"","mesosConstraintOperator":"CLUSTER","parametersLists":["Environment"],"parametersUsed":["Global.DEFAULT_OUTPUT_FIELD","Global.SPARK_CORES_MAX","Global.SPARK_DRIVER_CORES","Global.SPARK_DRIVER_JAVA_OPTIONS","Global.SPARK_DRIVER_MEMORY","Global.SPARK_EXECUTOR_CORES","Global.SPARK_EXECUTOR_EXTRA_JAVA_OPTIONS","Global.SPARK_EXECUTOR_MEMORY","Global.SPARK_LOCALITY_WAIT","Global.SPARK_LOCAL_PATH","Global.SPARK_MEMORY_FRACTION","Global.SPARK_TASK_MAX_FAILURES"],"udfsToRegister":[],"udafsToRegister":[],"mesosRole":""},"streamingSettings":{"window":"2s","blockInterval":"100ms","checkpointSettings":{"checkpointPath":"sparta/checkpoint","enableCheckpointing":true,"autoDeleteCheckpoint":true,"addTimeToCheckpointPath":false}},"sparkSettings":{"master":"mesos://leader.mesos:5050","sparkKerberos":true,"sparkDataStoreTls":true,"sparkMesosSecurity":true,"submitArguments":{"userArguments":[],"deployMode":"client","driverJavaOptions":"{{{Global.SPARK_DRIVER_JAVA_OPTIONS}}}"},"sparkConf":{"sparkResourcesConf":{"coresMax":"{{{Global.SPARK_CORES_MAX}}}","executorMemory":"{{{Global.SPARK_EXECUTOR_MEMORY}}}","executorCores":"{{{Global.SPARK_EXECUTOR_CORES}}}","driverCores":"{{{Global.SPARK_DRIVER_CORES}}}","driverMemory":"{{{Global.SPARK_DRIVER_MEMORY}}}","mesosExtraCores":"","localityWait":"{{{Global.SPARK_LOCALITY_WAIT}}}","taskMaxFailures":"{{{Global.SPARK_TASK_MAX_FAILURES}}}","sparkMemoryFraction":"{{{Global.SPARK_MEMORY_FRACTION}}}","sparkParallelism":""},"sparkHistoryServerConf":{"enableHistoryServerMonitoring":false},"userSparkConf":[],"coarse":true,"sparkUser":"","sparkLocalDir":"{{{Global.SPARK_LOCAL_PATH}}}","sparkKryoSerialization":false,"sparkSqlCaseSensitive":true,"logStagesProgress":false,"hdfsTokenCache":true,"executorExtraJavaOptions":"{{{Global.SPARK_EXECUTOR_EXTRA_JAVA_OPTIONS}}}"}},"errorsManagement":{"genericErrorManagement":{"whenError":"Error"},"transformationStepsManagement":{"whenError":"Error","whenRowError":"RowError","whenFieldError":"FieldError"},"transactionsManagement":{"sendToOutputs":[],"sendStepData":false,"sendPredecessorsData":true,"sendInputData":true}}},"pipelineGraph":{"nodes":[{"name":"FileOld","stepType":"Input","className":"FileSystemInputStep","classPrettyName":"FileSystem","arity":["NullaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":681.3251037597656,"y":179.5632781982422}},"configuration":{"path":"/tmp/dummy.csv","outputField":"{{{Global.DEFAULT_OUTPUT_FIELD}}}","debugOptions":"{\"userProvidedExample\":\"CodInterno;EAN;Matricula;DescripcionAlias;Descripcion02;Bondades;Estado;Categoria;GrupoProducto;ActivoExterno;Atributo01;Atributo02;Atributo03;Atributo04;Atributo05;Atributo06;Atributo07;Atributo08;Atributo09;Atributo10;Atributo11;Atributo12;Atributo13;Atributo14;Atributo15;Atributo16;Precio;linkImgL;linkImgM;linkImgS;PerteneceGrupo01;PerteneceGrupo02;PerteneceGrupo03;PerteneceGrupo04;PerteneceGrupo05;ServiciosObligatorios;ServiciosOpcionales;DeshabilitadoVenta;ActualizarImagen;ActualizarProductos;FamiliaAntigua\\n23904;3286340700016;TFIR1756013077H00;175/60R13 EF.F FR.C R.723 77H 7000  FIREST;7000;;Activo;NEUMATICOS;TURISMO;False;RUEDAS;RUEDAS;FIRESTONE;F-700 FS;0;13;175;60;H;77;F;B;68;2;0;;53,99;;;;True;False;False;False;False;42398,9101013,9101005,18434;9101021,9101043,69813,9101009;False;False;False;109FIRT13H\"}"},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"FileNew","stepType":"Input","className":"FileSystemInputStep","classPrettyName":"FileSystem","arity":["NullaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":681.8664855957031,"y":513.4217529296875}},"configuration":{"path":"/tmp/motortown_productos_servicios.csv","outputField":"{{{Global.DEFAULT_OUTPUT_FIELD}}}","debugOptions":"{\"userProvidedExample\":\"CodInterno;EAN;Matricula;DescripcionAlias;Descripcion02;Bondades;Estado;Categoria;GrupoProducto;ActivoExterno;Atributo01;Atributo02;Atributo03;Atributo04;Atributo05;Atributo06;Atributo07;Atributo08;Atributo09;Atributo10;Atributo11;Atributo12;Atributo13;Atributo14;Atributo15;Atributo16;Precio;linkImgL;linkImgM;linkImgS;PerteneceGrupo01;PerteneceGrupo02;PerteneceGrupo03;PerteneceGrupo04;PerteneceGrupo05;ServiciosObligatorios;ServiciosOpcionales;DeshabilitadoVenta;ActualizarImagen;ActualizarProductos;FamiliaAntigua\\n23904;3286340700016;TFIR1756013077H00;175/60R13 EF.F FR.C R.723 77H 7000  FIREST;7000;;Activo;NEUMATICOS;TURISMO;False;RUEDAS;RUEDAS;FIRESTONE;F-700 FS;0;13;175;60;H;77;F;B;68;2;0;;53,99;;;;True;False;False;False;False;42398,9101013,9101005,18434;9101021,9101043,69813,9101009;False;False;False;109FIRT13H\"}"},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"Diff","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":682,"y":337}},"configuration":{"sql":"select raw from FileNew where raw not in \n (select raw from FileOld)","discardConditions":"[]","inputSchemas":"[]","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"DiffCsv","stepType":"Transformation","className":"CsvTransformStep","classPrettyName":"Csv","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":919,"y":337}},"configuration":{"schema.inputMode":"HEADER","schema.header":"CodInterno;EAN;Matricula;DescripcionAlias;Descripcion02;Bondades;Estado;Categoria;GrupoProducto;ActivoExterno;Atributo01;Atributo02;Atributo03;Atributo04;Atributo05;Atributo06;Atributo07;Atributo08;Atributo09;Atributo10;Atributo11;Atributo12;Atributo13;Atributo14;Atributo15;Atributo16;Precio;linkImgL;linkImgM;linkImgS;PerteneceGrupo01;PerteneceGrupo02;PerteneceGrupo03;PerteneceGrupo04;PerteneceGrupo05;ServiciosObligatorios;ServiciosOpcionales;DeshabilitadoVenta;ActualizarImagen;ActualizarProductos;FamiliaAntigua","delimiterType":"CHARACTER","inputSchemas":"[]","headerRemoval":true,"splitLimit":"-1","whenFieldError":"","whenRowError":"","fieldsPreservationPolicy":"REPLACE","inputField":"raw","delimiter":";"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"Postgres_1","stepType":"Output","className":"PostgresOutputStep","classPrettyName":"Postgres","arity":["NullaryToNullary","NaryToNullary"],"writer":{"saveMode":"Append"},"uiConfiguration":{"position":{"x":1842.717088973787,"y":339.90017984489845}},"configuration":{"errorSink":false,"url":"jdbc:postgresql://sparta-postgres:5432/postgres?user=postgres&prepareThreshold=0","postgresSaveMode":"STATEMENT","batchsize":"1000","isolationLevel":"READ_UNCOMMITTED","failFast":true,"tlsEnabled":false,"driver":"","schemaFromDatabase":false,"saveOptions":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","lineageProperties":[]},{"name":"Atributtes","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1134.4417322823067,"y":337.539278492168}},"configuration":{"sql":"select CodInterno, EAN, Matricula, DescripcionAlias,Descripcion02,Categoria\n\t,Atributo03,Atributo04\n\t,linkImgL,linkImgM,linkImgS\n\t,ServiciosObligatorios,ServiciosOpcionales\n\t,ActivoExterno,Precio\n ,concat (\n regexp_replace('activoexterno=0,','0', ActivoExterno)\n ,'cai=103293,'\n ,'color=red,'\n ,regexp_replace('diameter=16,','16',Atributo06)\n ,regexp_replace('ean=3528707773869,','3528707773869',EAN)\n ,regexp_replace('height=55,','55',Atributo08)\n ,'homologation=,'\n ,'is_matricula=Yes,'\n ,'label_icon_1=C,'\n ,'label_icon_2=A,'\n ,'label_icon_3=1,'\n ,'label_icon_4=68,'\n ,regexp_replace('load_index=94,','94',Atributo10)\n ,regexp_replace('manufacturer=micheline,','micheline','micheline') /*revisar posiblesvalores*/\n ,regexp_replace('matricula=TEST,','TEST',Matricula)\n ,'on_hover=png,'\n ,'runflat=no,'\n ,regexp_replace('season=I,','I',Atributo05)\n ,regexp_replace('speed_index=H,','H','H')\n ,'tyre_group=Marca l√≠der,'\n ,regexp_replace('tyre_model=TESTMODELO,','TESTMODELO',Atributo04)\n ,'tyre_store=Motortown,'\n ,regexp_replace('vehicle_type=turismo,','turismo','turismo') /*revisar posibles valores*/\n ,regexp_replace('width=205','205',Atributo07)\n ) as  additional_attributes \nfrom DiffCsv\n where Categoria='NEUMATICOS'","discardConditions":"[]","inputSchemas":"[]","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"ProductsFields","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1359.9092404609512,"y":335.17834783121293}},"configuration":{"sql":"Select \nconcat('\"', coalesce(EAN,''), '\"') as  sku ,\nconcat('\"', coalesce('',''), '\"') as  store_view_code,\nconcat('\"', coalesce('Neumaticos',''), '\"') as  attribute_set_code ,\nconcat('\"', coalesce('simple',''), '\"') as  product_type ,\nconcat('\"', coalesce('Default Category/Neum√°ticos',''), '\"') as  categories ,\nconcat('\"', coalesce('base',''), '\"') as  product_websites ,\nconcat('\"', coalesce(concat(Atributo03,' ', Atributo04) ,''), '\"') as  name ,\nconcat('\"', coalesce(DescripcionAlias,''), '\"') as  description ,\nconcat('\"', coalesce(DescripcionAlias,''), '\"') as  short_description ,\nconcat('\"', coalesce('',''), '\"') as  weight ,\nconcat('\"', coalesce('1',''), '\"') as  product_online ,\nconcat('\"', coalesce('Taxable Goods',''), '\"') as  tax_class_name ,\nconcat('\"', coalesce('Catalog, Search',''), '\"') as  visibility ,\nconcat('\"', coalesce('0',''), '\"') as  price,\nconcat('\"', coalesce('',''), '\"') as  special_price ,\nconcat('\"', coalesce('',''), '\"') as  special_price_from_date ,\nconcat('\"', coalesce('',''), '\"') as  special_price_to_date ,\nconcat('\"', coalesce(EAN,''), '\"') as  url_key ,\nconcat('\"', coalesce('',''), '\"') as  meta_title ,\nconcat('\"', coalesce('',''), '\"') as  meta_keywords ,\nconcat('\"', coalesce('',''), '\"') as  meta_description ,\nconcat('\"', coalesce('',''), '\"') as  base_image ,\nconcat('\"', coalesce('',''), '\"') as  base_image_label ,\nconcat('\"', coalesce('',''), '\"') as  small_image ,\nconcat('\"', coalesce('',''), '\"') as  small_image_label ,\nconcat('\"', coalesce('',''), '\"') as  thumbnail_image ,\nconcat('\"', coalesce('',''), '\"') as  thumbnail_image_label ,\nconcat('\"', coalesce('',''), '\"') as  swatch_image ,\nconcat('\"', coalesce('',''), '\"') as  swatch_image_label ,\nconcat('\"', coalesce('',''), '\"') as  created_at ,\nconcat('\"', coalesce('',''), '\"') as  updated_at ,\nconcat('\"', coalesce('',''), '\"') as  new_from_date ,\nconcat('\"', coalesce('',''), '\"') as  new_to_date ,\nconcat('\"', coalesce('',''), '\"') as  display_product_options_in ,\nconcat('\"', coalesce('',''), '\"') as  map_price ,\nconcat('\"', coalesce('',''), '\"') as  msrp_price ,\nconcat('\"', coalesce('',''), '\"') as  map_enabled ,\nconcat('\"', coalesce('',''), '\"') as  gift_message_available ,\nconcat('\"', coalesce('',''), '\"') as  custom_design ,\nconcat('\"', coalesce('',''), '\"') as  custom_design_from ,\nconcat('\"', coalesce('',''), '\"') as  custom_design_to ,\nconcat('\"', coalesce('',''), '\"') as  custom_layout_update ,\nconcat('\"', coalesce('',''), '\"') as  page_layout ,\nconcat('\"', coalesce('',''), '\"') as  product_options_container ,\nconcat('\"', coalesce('',''), '\"') as  msrp_display_actual_price_type ,\nconcat('\"', coalesce('',''), '\"') as  country_of_manufacture ,\nconcat('\"', coalesce(additional_attributes,''), '\"') as  additional_attributes ,\nconcat('\"', coalesce('',''), '\"') as  qty ,\nconcat('\"', coalesce('',''), '\"') as  out_of_stock_qty ,\nconcat('\"', coalesce('',''), '\"') as  use_config_min_qty ,\nconcat('\"', coalesce('',''), '\"') as  is_qty_decimal ,\nconcat('\"', coalesce('',''), '\"') as  allow_backorders ,\nconcat('\"', coalesce('',''), '\"') as  use_config_backorders ,\nconcat('\"', coalesce('',''), '\"') as  min_cart_qty ,\nconcat('\"', coalesce('',''), '\"') as  use_config_min_sale_qty ,\nconcat('\"', coalesce('',''), '\"') as  max_cart_qty ,\nconcat('\"', coalesce('',''), '\"') as  use_config_max_sale_qty ,\nconcat('\"', coalesce('',''), '\"') as  is_in_stock ,\nconcat('\"', coalesce('',''), '\"') as  notify_on_stock_below ,\nconcat('\"', coalesce('',''), '\"') as  use_config_notify_stock_qty ,\nconcat('\"', coalesce('',''), '\"') as  manage_stock ,\nconcat('\"', coalesce('',''), '\"') as  use_config_manage_stock ,\nconcat('\"', coalesce('',''), '\"') as  use_config_qty_increments ,\nconcat('\"', coalesce('',''), '\"') as  qty_increments ,\nconcat('\"', coalesce('',''), '\"') as  use_config_enable_qty_inc ,\nconcat('\"', coalesce('',''), '\"') as  enable_qty_increments ,\nconcat('\"', coalesce('',''), '\"') as  is_decimal_divided ,\nconcat('\"', coalesce('',''), '\"') as  website_id ,\nconcat('\"', coalesce('',''), '\"') as  related_skus ,\nconcat('\"', coalesce('',''), '\"') as  related_position ,\nconcat('\"', coalesce('',''), '\"') as  crosssell_skus ,\nconcat('\"', coalesce('',''), '\"') as  crosssell_position ,\nconcat('\"', coalesce('',''), '\"') as  upsell_skus ,\nconcat('\"', coalesce('',''), '\"') as  upsell_position ,\nconcat('\"', coalesce('',''), '\"') as  additional_images ,\nconcat('\"', coalesce('',''), '\"') as  additional_image_labels ,\nconcat('\"', coalesce('',''), '\"') as  hide_from_product_page ,\nconcat('\"', coalesce('',''), '\"') as  custom_options ,\nconcat('\"', coalesce('',''), '\"') as  bundle_price_type ,\nconcat('\"', coalesce('',''), '\"') as  bundle_sku_type ,\nconcat('\"', coalesce('',''), '\"') as  bundle_price_view ,\nconcat('\"', coalesce('',''), '\"') as  bundle_weight_type ,\nconcat('\"', coalesce('',''), '\"') as  bundle_values ,\nconcat('\"', coalesce('',''), '\"') as  bundle_shipment_type ,\nconcat('\"', coalesce('',''), '\"') as  configurable_variations ,\nconcat('\"', coalesce('',''), '\"') as  configurable_variation_labels ,\nconcat('\"', coalesce('',''), '\"') as  associated_skus \nfrom Atributtes\n","discardConditions":"[]","inputSchemas":"[]","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"ToCsvString","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1593.6400759452988,"y":337.53928915045515}},"configuration":{"sql":"select concat_ws\n(',',\nsku ,\nstore_view_code ,\nattribute_set_code,\nproduct_type ,\ncategories ,\nproduct_websites ,\nname ,\ndescription ,\nshort_description ,\nweight ,\nproduct_online ,\ntax_class_name ,\nvisibility ,\nprice ,\nspecial_price ,\nspecial_price_from_date ,\nspecial_price_to_date ,\nurl_key ,\nmeta_title ,\nmeta_keywords ,\nmeta_description ,\nbase_image ,\nbase_image_label ,\nsmall_image ,\nsmall_image_label ,\nthumbnail_image ,\nthumbnail_image_label ,\nswatch_image ,\nswatch_image_label ,\ncreated_at ,\nupdated_at ,\nnew_from_date ,\nnew_to_date ,\ndisplay_product_options_in ,\nmap_price ,\nmsrp_price ,\nmap_enabled ,\ngift_message_available ,\ncustom_design ,\ncustom_design_from ,\ncustom_design_to ,\ncustom_layout_update ,\npage_layout ,\nproduct_options_container ,\nmsrp_display_actual_price_type ,\ncountry_of_manufacture ,\nadditional_attributes ,\nqty ,\nout_of_stock_qty ,\nuse_config_min_qty ,\nis_qty_decimal ,\nallow_backorders ,\nuse_config_backorders ,\nmin_cart_qty ,\nuse_config_min_sale_qty ,\nmax_cart_qty ,\nuse_config_max_sale_qty ,\nis_in_stock ,\nnotify_on_stock_below ,\nuse_config_notify_stock_qty ,\nmanage_stock ,\nuse_config_manage_stock ,\nuse_config_qty_increments ,\nqty_increments ,\nuse_config_enable_qty_inc ,\nenable_qty_increments ,\nis_decimal_divided ,\nwebsite_id ,\nrelated_skus ,\nrelated_position ,\ncrosssell_skus ,\ncrosssell_position ,\nupsell_skus ,\nupsell_position ,\nadditional_images ,\nadditional_image_labels ,\nhide_from_product_page ,\ncustom_options ,\nbundle_price_type ,\nbundle_sku_type ,\nbundle_price_view ,\nbundle_weight_type ,\nbundle_values ,\nbundle_shipment_type ,\nconfigurable_variations ,\nconfigurable_variation_labels ,\nassociated_skus \n )\n from \n ProductsFields\n ","discardConditions":"[]","inputSchemas":"[]","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]}],"edges":[{"origin":"FileOld","destination":"Diff","dataType":"ValidData"},{"origin":"FileNew","destination":"Diff","dataType":"ValidData"},{"origin":"Diff","destination":"DiffCsv","dataType":"ValidData"},{"origin":"DiffCsv","destination":"Atributtes","dataType":"ValidData"},{"origin":"Atributtes","destination":"ProductsFields","dataType":"ValidData"},{"origin":"ProductsFields","destination":"ToCsvString","dataType":"ValidData"},{"origin":"ToCsvString","destination":"Postgres_1","dataType":"ValidData"}]},"executionEngine":"Batch","uiSettings":{"position":{"x":-109.01729289741525,"y":54.06101056461074,"k":0.8471280701163414}},"lastUpdateDate":"2019-04-12T15:19:37Z","version":1,"group":{"id":"940800b2-6d81-44a8-84d9-26913a2faea4","name":"/home"},"debugMode":false,"groupId":"940800b2-6d81-44a8-84d9-26913a2faea4"}